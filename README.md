# –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ:

## –õ–æ–≥–∏–Ω: default

## –ü–∞—Ä–æ–ª—å: default

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ì–ª–æ–±–∞–ª—å–Ω—ã–º –°–æ—Å—Ç–æ—è–Ω–∏–µ–º

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫–æ—Ñ–µ–π–Ω–∏ "Coffee Park" —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–≤—É—Ö —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤: Context API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–∞–º–∏ –∏ Redux Toolkit –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω–æ–π –ø–æ–∫—É–ø–æ–∫ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

## üîç –ó–∞–¥–∞–Ω–∏–µ 1: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### üé® **Context API - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏:**

1. **–¢–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–ª–æ–π/—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
2. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (UA/EN/RU)
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞, –∑–≤—É–∫–∏

#### üóÑÔ∏è **Redux - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏:**

1. **–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤
2. **–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø—Ä–æ—Ñ–∏–ª—å, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ª–æ—è–ª—å–Ω–æ—Å—Ç—å
3. **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤** - –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**Context API –≤—ã–±—Ä–∞–Ω –¥–ª—è:** –¢–µ–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ, –≥–ª–æ–±–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)  
**Redux –≤—ã–±—Ä–∞–Ω –¥–ª—è:** –ö–æ—Ä–∑–∏–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

## üé® –ó–∞–¥–∞–Ω–∏–µ 2: Context API Implementation

### ThemeContext - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏

#### **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

**–§–∞–π–ª:** `contexts/ThemeContext.js`

```jsx
import React, { createContext, useContext, useReducer, useEffect } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { lightTheme, darkTheme } from '../themes/colors';

// –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ–º
export const ThemeContext = createContext();

// –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–º—ã
const initialState = {
  isDark: false,
  theme: lightTheme,
  isLoading: true,
};

// Reducer –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–∞–º–∏
const themeReducer = (state, action) => {
  switch (action.type) {
    case 'TOGGLE_THEME':
      return {
        ...state,
        isDark: !state.isDark,
        theme: !state.isDark ? darkTheme : lightTheme,
      };
    case 'SET_THEME':
      return {
        ...state,
        isDark: action.payload === 'dark',
        theme: action.payload === 'dark' ? darkTheme : lightTheme,
      };
    case 'SET_LOADING':
      return {
        ...state,
        isLoading: action.payload,
      };
    case 'INITIALIZE_THEME':
      return {
        ...state,
        isDark: action.payload.isDark,
        theme: action.payload.isDark ? darkTheme : lightTheme,
        isLoading: false,
      };
    default:
      return state;
  }
};

// ThemeProvider –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
export const ThemeProvider = ({ children }) => {
  const [state, dispatch] = useReducer(themeReducer, initialState);

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  useEffect(() => {
    const loadTheme = async () => {
      try {
        const savedTheme = await AsyncStorage.getItem('user_theme');
        const isDark = savedTheme === 'dark';

        dispatch({
          type: 'INITIALIZE_THEME',
          payload: { isDark },
        });
      } catch (error) {
        console.log('Error loading theme:', error);
        dispatch({ type: 'SET_LOADING', payload: false });
      }
    };

    loadTheme();
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
  const toggleTheme = async () => {
    const newTheme = state.isDark ? 'light' : 'dark';

    try {
      await AsyncStorage.setItem('user_theme', newTheme);
      dispatch({ type: 'TOGGLE_THEME' });
    } catch (error) {
      console.log('Error saving theme:', error);
    }
  };

  // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–µ–º—ã
  const setTheme = async (themeName) => {
    try {
      await AsyncStorage.setItem('user_theme', themeName);
      dispatch({ type: 'SET_THEME', payload: themeName });
    } catch (error) {
      console.log('Error saving theme:', error);
    }
  };

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
  const getCurrentTheme = () => {
    return state.isDark ? 'dark' : 'light';
  };

  const value = {
    theme: state.theme,
    isDark: state.isDark,
    isLoading: state.isLoading,
    toggleTheme,
    setTheme,
    getCurrentTheme,
  };

  return (
    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
  );
};

// Custom hook –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã
export const useTheme = () => {
  const context = useContext(ThemeContext);

  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }

  return context;
};
```

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**

**–§–∞–π–ª:** `App.jsx`

```jsx
import React from 'react';
import { StatusBar } from 'expo-status-bar';
import { NavigationContainer } from '@react-navigation/native';
import { Provider as ReduxProvider } from 'react-redux';
import { ThemeProvider } from './contexts/ThemeContext';
import store from './store/store';
import MainDrawer from './navigation/MainDrawer';

export default function App() {
  return (
    <ReduxProvider store={store}>
      <ThemeProvider>
        <NavigationContainer>
          <StatusBar style="auto" />
          <MainDrawer />
        </NavigationContainer>
      </ThemeProvider>
    </ReduxProvider>
  );
}
```

#### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö**

**1. HomeScreen - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –∫ —ç–∫—Ä–∞–Ω—É:**

```jsx
import React from 'react';
import { View, Text, StyleSheet, ScrollView } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { useTheme } from '../contexts/ThemeContext';
import { SIZES } from '../constants/sizes';
import { FONT_WEIGHT } from '../constants/fontWeight';

const HomeScreen = ({ navigation }) => {
  const { theme, isDark, toggleTheme } = useTheme();

  const styles = StyleSheet.create({
    container: {
      flex: 1,
      backgroundColor: theme.background, // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
    },
    header: {
      paddingHorizontal: SIZES.padding,
      paddingVertical: SIZES.padding,
      backgroundColor: theme.cardBackground,
      borderBottomWidth: 1,
      borderBottomColor: theme.borderColor,
    },
    title: {
      fontSize: SIZES.h1,
      fontWeight: FONT_WEIGHT.bold,
      color: theme.primaryText, // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
      textAlign: 'center',
    },
    subtitle: {
      fontSize: SIZES.body,
      color: theme.secondaryText,
      textAlign: 'center',
      marginTop: 8,
    },
    content: {
      flex: 1,
      padding: SIZES.padding,
    },
    themeButton: {
      backgroundColor: theme.brandColor,
      paddingVertical: 12,
      paddingHorizontal: 24,
      borderRadius: 8,
      alignSelf: 'center',
      marginTop: 20,
    },
    themeButtonText: {
      color: theme.buttonText,
      fontSize: SIZES.fontMedium,
      fontWeight: FONT_WEIGHT.medium,
    },
  });

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.title}>Coffee Park</Text>
        <Text style={styles.subtitle}>
          {isDark ? '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞'}
        </Text>
      </View>

      <ScrollView style={styles.content}>
        {/* Theme Toggle Button */}
        <TouchableOpacity
          style={styles.themeButton}
          onPress={toggleTheme}
          activeOpacity={0.8}
        >
          <Text style={styles.themeButtonText}>
            {isDark ? '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞' : 'üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞'}
          </Text>
        </TouchableOpacity>

        {/* –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
      </ScrollView>
    </SafeAreaView>
  );
};

export default HomeScreen;
```

**2. ProductCard - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º:**

```jsx
import React, { memo, useMemo } from 'react';
import { View, Text, Image, TouchableOpacity, StyleSheet } from 'react-native';
import { useTheme } from '../contexts/ThemeContext';
import CustomButton from './CustomButton';
import { SIZES } from '../constants/sizes';
import { FONT_WEIGHT } from '../constants/fontWeight';

const ProductCard = memo(({ product, onAddToCart }) => {
  const { theme } = useTheme();

  // –ú–µ–º–æ–∏–∑–∏—Ä—É–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  const dynamicStyles = useMemo(
    () =>
      StyleSheet.create({
        card: {
          backgroundColor: theme.cardBackground,
          borderRadius: SIZES.radius,
          padding: SIZES.padding,
          marginBottom: SIZES.margin,
          shadowColor: theme.shadowColor,
          shadowOffset: { width: 0, height: 2 },
          shadowOpacity: 0.1,
          shadowRadius: 4,
          elevation: 3,
          borderWidth: 1,
          borderColor: theme.borderColor,
        },
        title: {
          fontSize: SIZES.fontLarge,
          fontWeight: FONT_WEIGHT.bold,
          color: theme.primaryText,
          marginBottom: 8,
        },
        description: {
          fontSize: SIZES.fontMedium,
          color: theme.secondaryText,
          marginBottom: 12,
          lineHeight: 20,
        },
        price: {
          fontSize: SIZES.fontLarge,
          fontWeight: FONT_WEIGHT.bold,
          color: theme.brandColor,
          marginBottom: 16,
        },
      }),
    [theme]
  );

  return (
    <View style={dynamicStyles.card}>
      <Image source={{ uri: product.image }} style={styles.image} />
      <Text style={dynamicStyles.title}>{product.name}</Text>
      <Text style={dynamicStyles.description}>{product.description}</Text>
      <Text style={dynamicStyles.price}>{product.price} ‚Ç¥</Text>

      <CustomButton
        title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
        onPress={() => onAddToCart(product)}
        variant="primary"
      />
    </View>
  );
});

const styles = StyleSheet.create({
  image: {
    width: '100%',
    height: 150,
    borderRadius: SIZES.radius,
    marginBottom: 12,
  },
});

ProductCard.displayName = 'ProductCard';
export default ProductCard;
```

#### **–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö**

**–§–∞–π–ª:** `components/ThemeToggle.jsx`

```jsx
import React from 'react';
import { View, Text, Switch, StyleSheet } from 'react-native';
import { useTheme } from '../contexts/ThemeContext';
import { SIZES } from '../constants/sizes';
import { FONT_WEIGHT } from '../constants/fontWeight';

const ThemeToggle = () => {
  const { theme, isDark, toggleTheme } = useTheme();

  const styles = StyleSheet.create({
    container: {
      flexDirection: 'row',
      justifyContent: 'space-between',
      alignItems: 'center',
      paddingVertical: SIZES.padding,
      paddingHorizontal: SIZES.padding,
      backgroundColor: theme.cardBackground,
      borderRadius: SIZES.radius,
      marginVertical: 8,
    },
    label: {
      fontSize: SIZES.fontMedium,
      fontWeight: FONT_WEIGHT.medium,
      color: theme.primaryText,
    },
    description: {
      fontSize: SIZES.fontSmall,
      color: theme.secondaryText,
      marginTop: 4,
    },
  });

  return (
    <View style={styles.container}>
      <View style={{ flex: 1 }}>
        <Text style={styles.label}>
          {isDark ? 'üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞'}
        </Text>
        <Text style={styles.description}>
          {isDark
            ? '–¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–∞ –≥–ª–∞–∑'
            : '–°–≤–µ—Ç–ª—ã–π —Ä–µ–∂–∏–º –¥–ª—è —è—Ä–∫–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è'}
        </Text>
      </View>

      <Switch
        value={isDark}
        onValueChange={toggleTheme}
        trackColor={{
          false: theme.switchTrackOff,
          true: theme.brandColor,
        }}
        thumbColor={isDark ? theme.switchThumbOn : theme.switchThumbOff}
        ios_backgroundColor={theme.switchTrackOff}
      />
    </View>
  );
};

export default ThemeToggle;
```

## üóÑÔ∏è –ó–∞–¥–∞–Ω–∏–µ 3: Redux Integration

### Redux Store Architecture

#### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Store**

**–§–∞–π–ª:** `store/store.js`

```javascript
import { configureStore } from '@reduxjs/toolkit';

// –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö slice reducers
import cartReducer from './cartSlice';
import productsReducer from './productsSlice';
import categoriesReducer from './categoriesSlice';
import ordersReducer from './ordersSlice';
import userReducer from './userSlice';
import loyaltyReducer from './loyaltySlice';
import paymentMethodsReducer from './paymentMethodsSlice';
import userIdReducer from './userIdSlice';
import appReducer from './appSlice';

const store = configureStore({
  reducer: {
    cart: cartReducer,
    products: productsReducer,
    categories: categoriesReducer,
    orders: ordersReducer,
    user: userReducer,
    loyalty: loyaltyReducer,
    paymentMethods: paymentMethodsReducer,
    userId: userIdReducer,
    app: appReducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['persist/PERSIST'],
      },
    }),
});

export default store;
```

#### **CartSlice - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π**

**–§–∞–π–ª:** `store/cartSlice.js`

```javascript
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { cartApi } from '../services/apiService';

// Async thunks –¥–ª—è API –æ–ø–µ—Ä–∞—Ü–∏–π
export const fetchCart = createAsyncThunk(
  'cart/fetchCart',
  async (userId, { rejectWithValue }) => {
    try {
      const response = await cartApi.getCart(userId);
      if (response.status === 'success' && Array.isArray(response.data)) {
        return response.data.filter((item) => item.userId === userId);
      }
      return [];
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const addToCart = createAsyncThunk(
  'cart/addToCart',
  async ({ productData, userId }, { dispatch, rejectWithValue }) => {
    try {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
      const existingCartResponse = await cartApi.getCart(userId);

      if (existingCartResponse.status === 'success') {
        const existingItems = existingCartResponse.data.filter(
          (item) => item.userId === userId
        );

        const existingItem = existingItems.find(
          (item) => item.productId === productData.id
        );

        if (existingItem) {
          // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞
          const newQuantity = (existingItem.quantity || 1) + 1;
          const updateResponse = await cartApi.updateCartItem(
            existingItem.id,
            newQuantity
          );

          if (updateResponse.status === 'success') {
            dispatch(fetchCart(userId));
            return updateResponse;
          }
        } else {
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
          const newCartItem = {
            userId: userId,
            productId: productData.id,
            name: productData.name,
            price: productData.price,
            image: productData.image,
            quantity: 1,
            category: productData.category || 'default',
          };

          const addResponse = await cartApi.addToCart(newCartItem);

          if (addResponse.status === 'success') {
            dispatch(fetchCart(userId));
            return addResponse;
          }
        }
      }

      throw new Error('Failed to add item to cart');
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const updateCartItemQuantity = createAsyncThunk(
  'cart/updateCartItemQuantity',
  async ({ id, newQuantity, userId }, { dispatch, rejectWithValue }) => {
    try {
      let response;

      if (newQuantity <= 0) {
        // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ 0 –∏–ª–∏ –º–µ–Ω—å—à–µ
        response = await cartApi.removeFromCart(id);
      } else {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        response = await cartApi.updateCartItem(id, newQuantity);
      }

      if (response?.status === 'success') {
        dispatch(fetchCart(userId));
      }

      return response;
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const removeFromCart = createAsyncThunk(
  'cart/removeFromCart',
  async ({ id, userId }, { dispatch, rejectWithValue }) => {
    try {
      const response = await cartApi.removeFromCart(id);

      if (response.status === 'success') {
        dispatch(fetchCart(userId));
      }

      return response;
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const clearCartByUser = createAsyncThunk(
  'cart/clearCartByUser',
  async (userId, { dispatch, rejectWithValue }) => {
    try {
      const response = await cartApi.getCart(userId);

      if (response.status !== 'success' || !Array.isArray(response.data)) {
        throw new Error('Failed to fetch cart');
      }

      const userCartItems = response.data.filter(
        (item) => item.userId === userId
      );

      // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      for (const item of userCartItems) {
        await cartApi.removeFromCart(item.id, userId);
      }

      dispatch(fetchCart(userId));
      return true;
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

// Slice definition
const cartSlice = createSlice({
  name: 'cart',
  initialState: {
    items: [],
    loading: false,
    error: null,
    totalAmount: 0,
    totalItems: 0,
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    calculateTotals: (state) => {
      const totals = state.items.reduce(
        (acc, item) => {
          acc.totalItems += item.quantity || 0;
          acc.totalAmount += (item.price || 0) * (item.quantity || 0);
          return acc;
        },
        { totalItems: 0, totalAmount: 0 }
      );

      state.totalItems = totals.totalItems;
      state.totalAmount = totals.totalAmount;
    },
  },
  extraReducers: (builder) => {
    builder
      // fetchCart cases
      .addCase(fetchCart.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchCart.fulfilled, (state, action) => {
        state.loading = false;
        state.items = action.payload;
        cartSlice.caseReducers.calculateTotals(state);
      })
      .addCase(fetchCart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      // addToCart cases
      .addCase(addToCart.pending, (state) => {
        state.loading = true;
      })
      .addCase(addToCart.fulfilled, (state) => {
        state.loading = false;
      })
      .addCase(addToCart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      // updateCartItemQuantity cases
      .addCase(updateCartItemQuantity.pending, (state) => {
        state.loading = true;
      })
      .addCase(updateCartItemQuantity.fulfilled, (state) => {
        state.loading = false;
      })
      .addCase(updateCartItemQuantity.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      });
  },
});

export const { clearError, calculateTotals } = cartSlice.actions;
export default cartSlice.reducer;
```

#### **UserSlice - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**

**–§–∞–π–ª:** `store/userSlice.js`

```javascript
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { userApi } from '../services/apiService';

// Async thunks –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
export const fetchUserProfile = createAsyncThunk(
  'user/fetchUserProfile',
  async (userId, { rejectWithValue }) => {
    try {
      const response = await userApi.getUser(userId);
      if (response.status === 'success') {
        return response.data;
      }
      throw new Error('Failed to fetch user profile');
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const updateUserProfile = createAsyncThunk(
  'user/updateUserProfile',
  async ({ userId, userData }, { rejectWithValue }) => {
    try {
      const response = await userApi.updateUser(userId, userData);
      if (response.status === 'success') {
        return response.data;
      }
      throw new Error('Failed to update user profile');
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const createUser = createAsyncThunk(
  'user/createUser',
  async (userData, { rejectWithValue }) => {
    try {
      const response = await userApi.createUser(userData);
      if (response.status === 'success') {
        return response.data;
      }
      throw new Error('Failed to create user');
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const login = createAsyncThunk(
  'user/login',
  async ({ email, password }, { rejectWithValue }) => {
    try {
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º credentials
      const response = await userApi.getAllUsers();

      if (response.status === 'success') {
        const user = response.data.find(
          (u) => u.email === email && u.password === password
        );

        if (user) {
          return user;
        } else {
          throw new Error('Invalid email or password');
        }
      }

      throw new Error('Login failed');
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

export const logout = createAsyncThunk(
  'user/logout',
  async (_, { rejectWithValue }) => {
    try {
      // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ—Å—Å–∏–π
      return true;
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

// User slice definition
const userSlice = createSlice({
  name: 'user',
  initialState: {
    profile: null,
    isAuthenticated: false,
    loading: false,
    error: null,
    lastLoginTime: null,
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    setAuthenticated: (state, action) => {
      state.isAuthenticated = action.payload;
    },
    clearUserData: (state) => {
      state.profile = null;
      state.isAuthenticated = false;
      state.lastLoginTime = null;
    },
  },
  extraReducers: (builder) => {
    builder
      // fetchUserProfile cases
      .addCase(fetchUserProfile.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchUserProfile.fulfilled, (state, action) => {
        state.loading = false;
        state.profile = action.payload;
      })
      .addCase(fetchUserProfile.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      // login cases
      .addCase(login.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(login.fulfilled, (state, action) => {
        state.loading = false;
        state.profile = action.payload;
        state.isAuthenticated = true;
        state.lastLoginTime = new Date().toISOString();
      })
      .addCase(login.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
        state.isAuthenticated = false;
      })
      // logout cases
      .addCase(logout.fulfilled, (state) => {
        state.profile = null;
        state.isAuthenticated = false;
        state.lastLoginTime = null;
        state.error = null;
      });
  },
});

export const { clearError, setAuthenticated, clearUserData } =
  userSlice.actions;
export default userSlice.reducer;
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redux –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

#### **CartScreen - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã**

**–§–∞–π–ª:** `screens/CartScreen.jsx`

```jsx
import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  TouchableOpacity,
  Alert,
  ActivityIndicator,
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { Ionicons } from '@expo/vector-icons';
import { useDispatch, useSelector } from 'react-redux';
import {
  updateCartItemQuantity,
  fetchCart,
  clearCartByUser,
  removeFromCart,
} from '../store/cartSlice';
import { useTheme } from '../contexts/ThemeContext';
import CartItem from '../components/CartItem';
import CustomButton from '../components/CustomButton';
import { SIZES } from '../constants/sizes';
import { FONT_WEIGHT } from '../constants/fontWeight';

const CartScreen = ({ navigation }) => {
  const dispatch = useDispatch();
  const { theme } = useTheme();

  // Redux state selectors
  const cartItems = useSelector((state) => state.cart.items);
  const loading = useSelector((state) => state.cart.loading);
  const error = useSelector((state) => state.cart.error);
  const totalAmount = useSelector((state) => state.cart.totalAmount);
  const totalItems = useSelector((state) => state.cart.totalItems);
  const userId = useSelector((state) => state.userId.value);

  // Local state
  const [refreshing, setRefreshing] = useState(false);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  useEffect(() => {
    if (userId) {
      dispatch(fetchCart(userId));
    }
  }, [userId, dispatch]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
  const handleQuantityChange = (itemId, newQuantity) => {
    if (newQuantity < 0) return;

    dispatch(
      updateCartItemQuantity({
        id: itemId,
        newQuantity,
        userId,
      })
    );
  };

  // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
  const handleRemoveItem = (itemId) => {
    Alert.alert(
      '–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä',
      '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?',
      [
        { text: '–û—Ç–º–µ–Ω–∞', style: 'cancel' },
        {
          text: '–£–¥–∞–ª–∏—Ç—å',
          style: 'destructive',
          onPress: () => dispatch(removeFromCart({ id: itemId, userId })),
        },
      ]
    );
  };

  // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π –∫–æ—Ä–∑–∏–Ω—ã
  const handleClearCart = () => {
    Alert.alert(
      '–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É',
      '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?',
      [
        { text: '–û—Ç–º–µ–Ω–∞', style: 'cancel' },
        {
          text: '–û—á–∏—Å—Ç–∏—Ç—å',
          style: 'destructive',
          onPress: () => dispatch(clearCartByUser(userId)),
        },
      ]
    );
  };

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
  const handleRefresh = async () => {
    setRefreshing(true);
    await dispatch(fetchCart(userId));
    setRefreshing(false);
  };

  // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
  const handleCheckout = () => {
    if (cartItems.length === 0) {
      Alert.alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞', '–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞');
      return;
    }

    navigation.navigate('OrderStatus', {
      orderData: {
        items: cartItems,
        totalAmount,
        totalItems,
        userId,
      },
    });
  };

  const styles = StyleSheet.create({
    container: {
      flex: 1,
      backgroundColor: theme.background,
    },
    header: {
      flexDirection: 'row',
      justifyContent: 'space-between',
      alignItems: 'center',
      paddingHorizontal: SIZES.padding,
      paddingVertical: SIZES.padding,
      backgroundColor: theme.cardBackground,
      borderBottomWidth: 1,
      borderBottomColor: theme.borderColor,
    },
    headerTitle: {
      fontSize: SIZES.h2,
      fontWeight: FONT_WEIGHT.bold,
      color: theme.primaryText,
    },
    cartCount: {
      fontSize: SIZES.fontMedium,
      color: theme.secondaryText,
    },
    content: {
      flex: 1,
    },
    emptyContainer: {
      flex: 1,
      justifyContent: 'center',
      alignItems: 'center',
      paddingHorizontal: SIZES.padding,
    },
    emptyText: {
      fontSize: SIZES.fontLarge,
      color: theme.secondaryText,
      textAlign: 'center',
      marginTop: 16,
    },
    loadingContainer: {
      flex: 1,
      justifyContent: 'center',
      alignItems: 'center',
    },
    errorContainer: {
      padding: SIZES.padding,
      backgroundColor: theme.errorBackground,
      margin: SIZES.margin,
      borderRadius: SIZES.radius,
    },
    errorText: {
      color: theme.errorText,
      textAlign: 'center',
    },
    footer: {
      padding: SIZES.padding,
      backgroundColor: theme.cardBackground,
      borderTopWidth: 1,
      borderTopColor: theme.borderColor,
    },
    totalContainer: {
      flexDirection: 'row',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: SIZES.margin,
    },
    totalLabel: {
      fontSize: SIZES.fontLarge,
      fontWeight: FONT_WEIGHT.bold,
      color: theme.primaryText,
    },
    totalAmount: {
      fontSize: SIZES.h3,
      fontWeight: FONT_WEIGHT.bold,
      color: theme.brandColor,
    },
    buttonContainer: {
      flexDirection: 'row',
      gap: 12,
    },
  });

  // Loading state
  if (loading && cartItems.length === 0) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color={theme.brandColor} />
          <Text style={[styles.emptyText, { marginTop: 16 }]}>
            –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...
          </Text>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      {/* Header */}
      <View style={styles.header}>
        <View>
          <Text style={styles.headerTitle}>–ö–æ—Ä–∑–∏–Ω–∞</Text>
          <Text style={styles.cartCount}>
            {totalItems} {totalItems === 1 ? '—Ç–æ–≤–∞—Ä' : '—Ç–æ–≤–∞—Ä–æ–≤'}
          </Text>
        </View>

        {cartItems.length > 0 && (
          <TouchableOpacity onPress={handleClearCart}>
            <Ionicons name="trash-outline" size={24} color={theme.errorColor} />
          </TouchableOpacity>
        )}
      </View>

      {/* Error state */}
      {error && (
        <View style={styles.errorContainer}>
          <Text style={styles.errorText}>{error}</Text>
          <CustomButton
            title="–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"
            onPress={handleRefresh}
            variant="outline"
            style={{ marginTop: 12 }}
          />
        </View>
      )}

      {/* Content */}
      {cartItems.length === 0 ? (
        <View style={styles.emptyContainer}>
          <Ionicons name="bag-outline" size={80} color={theme.secondaryText} />
          <Text style={styles.emptyText}>
            –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞{'\n'}
            –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
          </Text>
          <CustomButton
            title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º"
            onPress={() => navigation.navigate('Products')}
            style={{ marginTop: 24 }}
          />
        </View>
      ) : (
        <ScrollView
          style={styles.content}
          refreshControl={
            <RefreshControl
              refreshing={refreshing}
              onRefresh={handleRefresh}
              colors={[theme.brandColor]}
            />
          }
        >
          {cartItems.map((item) => (
            <CartItem
              key={item.id}
              item={item}
              onQuantityChange={handleQuantityChange}
              onRemove={handleRemoveItem}
            />
          ))}
        </ScrollView>
      )}

      {/* Footer with total and checkout */}
      {cartItems.length > 0 && (
        <View style={styles.footer}>
          <View style={styles.totalContainer}>
            <Text style={styles.totalLabel}>–ò—Ç–æ–≥–æ:</Text>
            <Text style={styles.totalAmount}>{totalAmount.toFixed(2)} ‚Ç¥</Text>
          </View>

          <View style={styles.buttonContainer}>
            <CustomButton
              title="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏"
              onPress={() => navigation.navigate('Products')}
              variant="outline"
              style={{ flex: 1 }}
            />
            <CustomButton
              title="–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
              onPress={handleCheckout}
              style={{ flex: 1 }}
              loading={loading}
            />
          </View>
        </View>
      )}
    </SafeAreaView>
  );
};

export default CartScreen;
```

#### **ProductsScreen - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É**

```jsx
import React, { useEffect, useState } from 'react';
import { View, StyleSheet, Alert } from 'react-native';
import { useDispatch, useSelector } from 'react-redux';
import { fetchProducts } from '../store/productsSlice';
import { addToCart } from '../store/cartSlice';
import { useTheme } from '../contexts/ThemeContext';
import ProductList from '../components/ProductList';

const ProductsScreen = ({ navigation }) => {
  const dispatch = useDispatch();
  const { theme } = useTheme();

  const products = useSelector((state) => state.products.items);
  const productsLoading = useSelector((state) => state.products.loading);
  const cartLoading = useSelector((state) => state.cart.loading);
  const userId = useSelector((state) => state.userId.value);

  useEffect(() => {
    dispatch(fetchProducts());
  }, [dispatch]);

  const handleAddToCart = async (product) => {
    if (!userId) {
      Alert.alert('–û—à–∏–±–∫–∞', '–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤');
      return;
    }

    try {
      await dispatch(
        addToCart({
          productData: product,
          userId,
        })
      ).unwrap();

      Alert.alert('–£—Å–ø–µ—à–Ω–æ', `${product.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`, [
        { text: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏', style: 'default' },
        {
          text: '–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É',
          onPress: () => navigation.navigate('Cart'),
        },
      ]);
    } catch (error) {
      Alert.alert('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }
  };

  return (
    <View style={[styles.container, { backgroundColor: theme.background }]}>
      <ProductList
        products={products}
        onAddToCart={handleAddToCart}
        loading={productsLoading || cartLoading}
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});

export default ProductsScreen;
```

## üì± –ó–∞–¥–∞–Ω–∏–µ 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
src/
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ ThemeContext.js        # Context API –¥–ª—è —Ç–µ–º
‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îú‚îÄ‚îÄ store.js              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redux store
‚îÇ   ‚îú‚îÄ‚îÄ cartSlice.js          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ userSlice.js          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ productsSlice.js      # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ appSlice.js           # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ CartItem.jsx          # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
‚îÇ   ‚îú‚îÄ‚îÄ ThemeToggle.jsx       # –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ CustomButton.jsx      # –ö–Ω–æ–ø–∫–∞ —Å —Ç–µ–º–∏–∑–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ CartScreen.jsx        # –≠–∫—Ä–∞–Ω –∫–æ—Ä–∑–∏–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ ProductsScreen.jsx    # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îî‚îÄ‚îÄ themes/
    ‚îî‚îÄ‚îÄ colors.js             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ–º
```

### –ü—Ä–æ–ø—Å—ã –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

#### **–ü–µ—Ä–µ–¥–∞—á–∞ ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:**

```jsx
const CartItem = ({ item, onQuantityChange, onRemove }) => {
  const handleRemove = () => {
    onRemove(item.id); // –ü–µ—Ä–µ–¥–∞–µ–º ID —Ç–æ–≤–∞—Ä–∞
  };

  const handleQuantityChange = (newQuantity) => {
    onQuantityChange(item.id, newQuantity); // ID + –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  };

  return (
    <View style={styles.item}>
      <Text>
        {item.name} - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {item.quantity}
      </Text>
      <TouchableOpacity onPress={handleRemove}>
        <Text style={styles.removeButton}>–£–¥–∞–ª–∏—Ç—å</Text>
      </TouchableOpacity>
    </View>
  );
};
```

### –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞

#### **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª:**

**–§–∞–π–ª:** `constants/cartConstants.js`

```javascript
export const CART_CONSTANTS = {
  MIN_QUANTITY: 1,
  MAX_QUANTITY: 99,
  ANIMATION_DURATION: 300,
  DEBOUNCE_DELAY: 500,
};

export const CART_STATUS = {
  EMPTY: 'empty',
  LOADING: 'loading',
  ERROR: 'error',
  READY: 'ready',
};

export const THEME_TYPES = {
  LIGHT: 'light',
  DARK: 'dark',
  AUTO: 'auto',
};
```

#### **–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏:**

```jsx
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ —Å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
const handleQuantityChange = useCallback(
  async (itemId, newQuantity) => {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞
    if (
      newQuantity < CART_CONSTANTS.MIN_QUANTITY ||
      newQuantity > CART_CONSTANTS.MAX_QUANTITY
    ) {
      Alert.alert('–û—à–∏–±–∫–∞', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞');
      return;
    }

    // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –ª—É—á—à–µ–≥–æ UX
    const originalItem = cartItems.find((item) => item.id === itemId);
    const optimisticItems = cartItems.map((item) =>
      item.id === itemId ? { ...item, quantity: newQuantity } : item
    );

    try {
      // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Redux
      await dispatch(
        updateCartItemQuantity({
          id: itemId,
          newQuantity,
          userId,
        })
      ).unwrap();
    } catch (error) {
      // –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      console.error('Failed to update quantity:', error);
      Alert.alert('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞');
    }
  },
  [dispatch, userId, cartItems]
);
```

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### **–ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:**

**–§–∞–π–ª:** `store/selectors.js`

```javascript
import { createSelector } from '@reduxjs/toolkit';

// –ë–∞–∑–æ–≤—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
const selectCartState = (state) => state.cart;
const selectUserIdState = (state) => state.userId;

// –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export const selectCartItems = createSelector(
  [selectCartState],
  (cart) => cart.items
);

export const selectCartLoading = createSelector(
  [selectCartState],
  (cart) => cart.loading
);

export const selectCartTotals = createSelector([selectCartItems], (items) => {
  return items.reduce(
    (acc, item) => {
      acc.totalItems += item.quantity || 0;
      acc.totalAmount += (item.price || 0) * (item.quantity || 0);
      return acc;
    },
    { totalItems: 0, totalAmount: 0 }
  );
});

export const selectCartItemById = createSelector(
  [selectCartItems, (state, itemId) => itemId],
  (items, itemId) => items.find((item) => item.id === itemId)
);

export const selectCartItemsCount = createSelector([selectCartItems], (items) =>
  items.reduce((sum, item) => sum + (item.quantity || 0), 0)
);
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### **Context API vs Redux —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:**

| –ê—Å–ø–µ–∫—Ç            | Context API (–¢–µ–º—ã)       | Redux (–ö–æ—Ä–∑–∏–Ω–∞)               |
| ----------------- | ------------------------ | ----------------------------- |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞**      | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞     | ‚ö†Ô∏è –ë–æ–ª—å—à–µ boilerplate         |
| **Performance**   | ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ  | ‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤      |
| **DevTools**      | ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞  | ‚úÖ Redux DevTools             |
| **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** | ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ | ‚úÖ createAsyncThunk           |
| **–†–∞–∑–º–µ—Ä bundle** | ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π           | ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**  | ‚ö†Ô∏è –ú–æ–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤      | ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:** –¢–µ–º—ã —á–µ—Ä–µ–∑ Context, –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Redux  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ slice'–æ–≤  
‚úÖ **Developer Experience:** Redux DevTools + Context  
‚úÖ **–¢–∏–ø–∏–∑–∞—Ü–∏—è:** TypeScript-ready –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Task 5

### ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 1** - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

- **Context API –¥–ª—è:** –¢–µ–º—ã, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **Redux –¥–ª—è:** –ö–æ—Ä–∑–∏–Ω–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã, –ª–æ—è–ª—å–Ω–æ—Å—Ç—å
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ª–æ–≥–∏–∫–∏

### ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 2** - Context API —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

- **ThemeContext:** –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å reducer'–æ–º –∏ AsyncStorage
- **ThemeProvider:** –û–±–µ—Ä—Ç–∫–∞ App.jsx —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
- **useTheme hook:** Custom hook –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **2+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:** HomeScreen, ProductCard, ThemeToggle —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ç–µ–º

### ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 3** - Redux –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- **Redux Toolkit:** configureStore —Å 8 slice'–∞–º–∏
- **CartSlice:** –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π (add, remove, update)
- **UserSlice:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
- **Async thunks:** API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ createAsyncThunk
- **useSelector/useDispatch:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### ‚úÖ **–ó–∞–¥–∞–Ω–∏–µ 4** - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –∏ slice'–æ–≤
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–ø—Å—ã:** ID —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ props
- **–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞:** –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã, React.memo

---

**–ü—Ä–æ–µ–∫—Ç:** Coffee Park App  
**State Management:** Context API + Redux Toolkit  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ú–æ–¥—É–ª—å–Ω–∞—è, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è  
**Performance:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å –º–µ–º–æ–∏–∑–∞—Ü–∏–µ–π
